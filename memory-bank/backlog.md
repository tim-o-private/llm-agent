- Backlog Item: Create "Architect" Agent
    - Description: Create a specialized AI agent designed to assist the user in defining, refining, and grooming backlog items. This agent will be deeply aware of the project's current state, architecture, and historical decisions to ensure new ideas are coherent with the overall project direction and documented comprehensively enough for seamless transition to implementation by other agents.
    - User Stories:
        - As a user, I can chat with a dedicated "architect" agent via the terminal REPL.
        - As a user, I want this agent to have read and write access to all files in the memory-bank (project directory).
        - As a user, I want this agent to maintain awareness of the project's current state by prioritizing core documentation (@prd.md, @systemPatterns.md, @backlog.md, @progress.md) and its own persistent chat history.
        - As a user, I want to discuss new feature ideas or requirements with the "architect" agent through a brainstorming conversation. 
        - As a user, I want the "architect" agent to guide me through defining new backlog items by asking clarifying questions based on the required backlog item structure.
        - As a user, I want the "architect" agent to translate our discussion into a comprehensive backlog item written in the standard @backlog.md format.
        - As a user, I want the "architect" agent to help groom the existing @backlog.md by assisting with re-prioritization, identifying related items, suggesting breaking down large items, marking items as deferred/duplicates, and prompting for more detail on items marked "Needs Refinement."
        - As a user, I want the "architect" agent to proactively identify potential conflicts or inconsistencies between new ideas/refined backlog items and the project's overall goals (@prd.md) or established architecture/patterns (@systemPatterns.md).
        - As a user, I want the "architect" agent to suggest technical approaches or constraints for backlog items to ensure consistency and coherence across implementations.
    - Definition & Refinement Guidance (for the Architect Agent): When defining or refining a backlog item, ensure the following aspects are considered and documented within the item where applicable:
        - Problem/Goal: What specific problem does this address, or what is the desired outcome?
        - User Value: Why is this important from a user's perspective? (Should align with User Story) 
        - Functional Requirements: What should the system do?
        - Non-Functional Considerations: Any performance, security, usability, etc., considerations?
        - Potential Technical Approach / Constraints: Initial thoughts on how this might be implemented, specific technologies to consider or avoid, known technical challenges. This is where the architect's guidance on consistency and elegance comes in.
        - Dependencies: Does this item depend on other backlog items or existing features? Are there other items that depend on this one?
        - Rough Effort Estimate: A very rough initial guess (e.g., Small, Medium, Large, or T-shirt size). This will be refined later.
        - Criteria for "Ready for PRD": What needs to be known or decided before this item can be moved from the backlog to the "Future Features" section of the PRD?
    - Notes / Questions (Specific to this item's implementation):
        - How will the agent maintain persistent memory of its own decision-making process across sessions, in addition to relying on systemPatterns.md, progress.md, and its chat history?
        - What specific tools will this agent need beyond file read/write? (e.g., a tool to summarize content, a tool to analyze document structure).
        How will the agent's prompt be structured to balance brainstorming flexibility with the need to guide towards a structured output format?
    - Priority: High
    - Status: DONE
    - Files Impacted (Conceptual):
        - src/cli/main.py (New agent command/loading)
        - config/agents/architect/ (New agent config directory)
        - data/agents/architect/ (New agent data directory)
        - src/core/agent_loader.py (Update to load this agent)
        - src/utils/chat_helpers.py (Potential updates for grooming commands)
        - src/tools/ (New tools for analyzing/summarizing docs, if needed)
        - @backlog.md (Agent will read and write to this)
        - @prd.md, @systemPatterns.md, @progress.md (Agent will read these for context)

- Backlog Item: Avoid redundant summarization
    - Description: Sessions are currently summarized periodically by the agent and at the close of the session. That potentially means we're making multiple updates in very short sessions.
    - User Stories: 
        - As a user, I want agents to independently maintain their own memory without approval.
        - As a user, I want to avoid rewriting memory if recent decisions or updates have already been made.
    - Notes / Questions:
        - Need to ensure that agents can't independently edit other files.
        - Can we alter the summarization prompt called at session close to only add items that are not currently on the summary?
    - Files impacted: TBD
    - Status: Needs refinement

- Backlog Item: Add Visibility for Tool Calls and Token Usage
    - Description: Create a log of tokens used for input and output.
    - User Story: As a user, I want to review how many tokens are consumed so that I estimate costs.
    - Notes / Questions
        - How to reliably access token usage from `langchain-google-genai`? Need research.
        - Need to verify the accuracy of token reporting.
    - Priority: Medium
    - Files impacted: TBD
    - Status: Needs Refinement

- Backlog Item: Implement Additional Agent Tools
    - Description: Add new tools to agents for enhanced capabilities like web search, reading specific external documents (e.g., Obsidian notes), calendar interaction, etc.
    - User Story: As a user, I want my agent to be able to search the web so that I can get up-to-date information or context. As a user, I want my agent to access my calendar so it can help me manage my schedule.
    - Notes / Questions:
        - Identify needed tools (e.g., `langchain_community.tools.tavily_search.TavilySearchResults`).
        - Implement custom tools if necessary (e.g., `ObsidianNoteReader`, Calendar Tool) following LangChain conventions. Define clear descriptions and argument schemas.
        - Update `load_tools` in `src/core/agent_loader.py` to handle instantiation based on `agent_config.yaml`.
        - Define how calendar interaction should work (read-only? create events?). Requires OAuth setup.
        - How to handle API keys/auth for new tools (e.g., Tavily, Google Calendar)? Store in `.env`.
        - Need tests for custom tools and integration tests for tool usage in agents.
    - Priority: High
    - Status: Needs Refinement

- Backlog Item: Refine Context Formatting and Prompting
    - Description: Improve how context (static, dynamic memory, tool outputs) is structured and presented in the prompt sent to the LLM for better reasoning and performance.
    - User Story: As a developer/user, I want the prompt structure to be optimized so that the LLM understands the context better and provides more relevant responses.
    - Notes / Questions:
        - Experiment with different prompt templating strategies (e.g., clearer section headings, specific ordering).
        - How does LangChain's AgentExecutor format tool output in the prompt? Can it be customized?
        - Review and potentially update system prompts in agent configurations.
        - This might be an ongoing iterative process.
    - Priority: Medium
    - Status: Needs Refinement

- Backlog Item: Enable Agent Self-Correction/Improvement
    - Description: Allow agents to suggest modifications to their own behavior or store learned preferences/notes within their dedicated data directory.
    - User Story: As a user, I want the agent to learn from our interactions or allow me to teach it preferences so that it becomes more helpful over time.
    - Notes / Questions:
        - Requires careful prompt engineering to instruct the agent on how/when to suggest changes or save notes.
        - Relies on file I/O tools (`read_config_tool`, `file_system_write_file`, `file_system_read_file`) being available and working correctly.
        - Need to ensure the agent only writes to its designated data directory (`data/agents/<agent_name>/`). Core prompt/config changes remain manual.
        - How to prevent the agent from overwriting critical data or getting into loops?
    - Priority: Low
    - Status: Idea

- Backlog Item: Comprehensive Testing
    - Description: Add more extensive unit and integration tests covering agent loading, REPL state management, command handling, and agent execution with various tool calls.
    - User Story: As a developer, I want comprehensive tests so that I can refactor code and add features confidently without introducing regressions.
    - Notes / Questions:
        - Focus on `src/cli/main.py`, `src/core/agent_loader.py`, `src/utils/chat_helpers.py`.
        - Requires mocking LLM responses and tool executions effectively.
        - Integration tests should cover common user flows (starting chat, switching agents, using tools, exiting).
    - Priority: Medium
    - Status: Needs Refinement

- Backlog Item: Update Documentation (README)
    - Description: Enhance the `README.md` file with detailed usage instructions for the `chat` command, agent configuration, available tools, setup steps, and examples.
    - User Story: As a new user/developer, I want clear documentation so that I can easily understand how to set up and use the application.
    - Notes / Questions:
        - Include sections on installation, configuration (`settings.yaml`, `.env`), agent structure (`config/agents/`), chat commands (`/exit`, `/agent`, `/summarize`), and available tools.
    - Priority: Medium
    - Status: Needs Refinement

- Backlog Item: Optimize Long-Term Memory Usage
    - Description: Investigate and potentially implement strategies like conversation summarization or token buffers to manage context efficiently for very long chat sessions, preventing excessive token usage or context window limitations.
    - User Story: As a user engaging in long conversations, I want the agent to retain relevant context without exceeding token limits so that the interaction remains coherent and cost-effective.
    - Notes / Questions:
        - Research LangChain's memory modules (e.g., `ConversationSummaryBufferMemory`, `VectorStoreRetrieverMemory`).
        - How to trigger summarization? Automatically based on token count? Manually via command?
        - Where to store summaries? In the memory JSON? Separate file?
        - Evaluate trade-offs between context fidelity and token savings.
    - Priority: Low
    - Status: Idea

- Backlog Item: Address LangChain Deprecation Warnings
    - Description: Perform a full audit of the codebase to identify and update any remaining LangChain imports or usage patterns that trigger deprecation warnings.
    - User Story: As a developer, I want the codebase to use up-to-date library patterns so that it remains maintainable and compatible with future LangChain versions.
    - Notes / Questions:
        - Run the application and tests, noting all warnings.
        - Consult LangChain documentation for recommended replacements.
        - Requires careful testing after changes.
        - Some warnings might require specific `langchain-community`, `langchain-core`, etc. installs.
    - Priority: Low
    - Status: Needs Refinement

- Backlog Item: Improve Logging Implementation
    - Description: Refactor logging setup to use a dedicated application logger instead of modifying the root logger. Ensure consistent use of logger levels (e.g., `logger.error` for exceptions).
    - User Story: As a developer, I want structured and configurable logging so that I can effectively debug issues and monitor application behavior.
    - Notes / Questions:
        - Implement logger configuration in `src/cli/main.py` or a dedicated logging utility.
        - Configure logger format and output (file/console) based on `settings.yaml`.
        - Replace `print` statements used for error reporting (e.g., in `file_parser.py`) with `logger.error`.
    - Priority: Medium
    - Status: Needs Refinement (Code Review Follow-up)

- Backlog Item: Enhance Error Handling
    - Description: Improve the granularity of error handling, especially during agent loading, and provide more informative messages to the user.
    - User Story: As a user, I want clear error messages when something goes wrong (e.g., agent config missing) so that I can understand and fix the problem.
    - Notes / Questions:
        - Review error handling in `src/cli/main.py` and `src/core/agent_loader.py`.
        - Add specific exception types and catch blocks.
        - Clarify behavior if `agent_config_dir` is missing when `read_config_tool` is required.
    - Priority: Medium
    - Status: Needs Refinement (Code Review Follow-up)

- Backlog Item: Refactor for Code Clarity and Readability
    - Description: Apply various refactoring suggestions to improve code structure, reduce complexity, and enhance maintainability.
    - User Story: As a developer, I want the code to be clean and easy to understand so that maintenance and future development are efficient.
    - Notes / Questions:
        - Return dataclass/dict from `process_user_command` (`main.py`, `chat_helpers.py`).
        - Abstract tool configuration/renaming logic in `load_tools` (`agent_loader.py`).
        - Refine LLM parameter handling (`agent_loader.py`).
        - Make prompt construction from `agent_config` more explicit (`agent_loader.py`).
        - Clean up `ContextManager` (docstring, unused elements).
        - Remove unnecessary `pass` (`main.py`).
    - Priority: Medium
    - Status: Needs Refinement (Code Review Follow-up)

- Backlog Item: Standardize Memory Management
    - Description: Investigate using standard LangChain `AgentExecutor` memory integration instead of the current manual load/save mechanism in `chat_helpers.py`. If manual is necessary, document why.
    - User Story: As a developer, I want memory management to follow standard patterns so that it's easier to understand and integrate with other LangChain features.
    - Notes / Questions:
        - Can LangChain's memory persistence handle saving to specific agent directories?
        - Does it integrate seamlessly with `prompt_toolkit` REPL structure?
        - Ensure summary prompt aligns with available tools if using integrated memory (`chat_helpers.py`).
    - Priority: Medium
    - Status: Needs Refinement (Code Review Follow-up)

- Backlog Item: Implement Proper Packaging
    - Description: Create a standalone executable using PyInstaller for easier distribution.
    - User Story: As a user, I want a single executable file so that I can run the application without needing to install Python or dependencies manually.
    - Notes / Questions:
        - Task paused due to unresolved issues with PyInstaller's `--add-data` not correctly bundling the `config` directory. Needs further investigation or manual `.spec` file editing.
    - Priority: Low
    - Status: Deferred

- Backlog Item: Refactor Project Structure for Proper Packaging and Module Imports
    - Description: Address current import hacks (e.g., `sys.path` modifications) and implement a standard Python packaging structure (e.g., using `pyproject.toml` and `setuptools`). This will improve maintainability, testability, and prepare the project for potential distribution.
    - User Stories:
        - As a developer, I want the project to use a standard packaging setup so that imports are reliable and work without workarounds.
        - As a developer, I want to be able to build and install the project using standard Python tools (e.g., `pip install -e .`).
    - Notes / Questions:
        - Review all `sys.path` modifications and remove them.
        - Decide on packaging tools (e.g., `setuptools`, `poetry`).
        - Create `pyproject.toml` or `setup.py`.
        - Adjust import statements throughout the codebase (`src/`, `tests/`).
        - Ensure tests run correctly with the new structure.
    - Priority: High
    - Status: To Do

- Backlog Item: Investigate and Fix Failing Pytest Suite
    - Description: Diagnose the root cause of the widespread failures in the `pytest` suite and implement the necessary corrections to ensure all tests pass reliably.
    - User Stories:
        - As a developer, I want a stable and passing test suite so that I can confidently refactor code and add new features.
        - As a developer, I want clear error messages from tests to quickly identify and fix issues.
    - Notes / Questions:
        - Systematically run tests to identify common failure patterns.
        - Check for issues related to the recent project structure changes or import problems.
        - Verify test environment setup, dependencies, and mocking strategies.
        - Update or rewrite tests as needed.
    - Priority: High
    - Status: To Do

- Backlog Item: Prepare Project for Public Release: Scrub Sensitive Data
    - Description: Identify and remove or anonymize all sensitive information from the project before it can be shared publicly on GitHub. This includes chat histories, specific API keys in examples (if any), and personal data within the `memory-bank/`.
    - User Stories:
        - As a project maintainer, I want to share the project publicly without exposing any private or sensitive user data.
        - As a potential contributor, I want to be able to fork and experiment with the project without encountering personal data from the original author.
    - Notes / Questions:
        - List all files/directories containing sensitive information (e.g., `memory-bank/`, `data/agents/*/memory/chat_history.json`, `data/agents/*/session_log.md`).
        - Determine the best strategy: exclusion via `.gitignore` for a public branch, a cleaning script, or manual removal.
        - Ensure example configuration files do not contain real keys.
        - Provide clear instructions for users on how to set up their own sensitive data (e.g., API keys via `.env`).
    - Priority: Medium
    - Status: To Do

- Backlog Item: Implement CI/CD Pipeline for Automated Pytest on PRs
    - Description: Set up a continuous integration (CI) pipeline, likely using GitHub Actions, to automatically run the `pytest` suite whenever a Pull Request is submitted to the main development branch. The pipeline should block merging of PRs if any tests fail.
    - User Stories:
        - As a developer, I want tests to run automatically on every PR to catch regressions early.
        - As a project maintainer, I want to ensure that only code with passing tests is merged into the main branch.
    - Notes / Questions:
        - Choose a CI/CD platform (GitHub Actions is a common choice for GitHub projects).
        - Create a workflow file (e.g., `.github/workflows/python-test.yml`).
        - Configure the workflow to set up Python, install dependencies (from `requirements.txt`), and run `pytest`.
        - Ensure the workflow correctly reports test success/failure status to the PR.
        - Configure branch protection rules on GitHub to require passing tests before merging.
    - Priority: Medium
    - Status: To Do
