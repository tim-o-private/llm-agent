---
description: Review this file whenever you begin a new chat, if the user requests you refresh the project structure, or you begin to be unclear on next steps.
globs: 
alwaysApply: false
---
# Project Structure and Requirements - Guidance for AI

This document provides instructions and context for the AI coding assistant to ensure effective collaboration on the project.

## Core Project Documents (Highest Priority Context)

Always prioritize understanding and adhering to the requirements and structure defined in these documents:

- **Product Requirements:** `@prd.md` (Contains project goals, user stories, and features - **including future features**)
- **Technical Stack:** `@techstack.md` (Defines chosen technologies and libraries)
- **Project Structure & Rules:** `@project-structure.md` (Defines organization and AI interaction rules)
- **Implementation Plan:** `@implementation-plan.md` (Refer to the step-by-step guide for current tasks and planned refactoring)
- **System Patterns:** `@systemPatterns.md` (Reference for architecture, design patterns, and documentation style)
- **Backlog:** `@backlog.md` (Repository for potential future ideas and tasks - **raw ideas**)
- **Progress Log:** `@progress.md` (Tracks completed tasks and current focus)

## Context Prioritization Guidelines

When processing information and generating code or responses, prioritize context in the following order:

1.  **The User's Current Prompt:** Directly address the user's latest request and any specific files or code snippets mentioned.
2.  **Relevant Project Files:** Focus on files directly related to the current task (e.g., if working on `file_parser.py`, prioritize its content and relevant tests).
3.  **Core Project Documents:** Refer back to `@prd.md`, `@techstack.md`, `@project-structure.md`, `@implementation-plan.md`, `@systemPatterns.md`, `@backlog.md`, and `@progress.md` for overall guidance, requirements, and potential future scope.
4.  **Global Context Files:** Include relevant information from `data/global_context/` (e.g., `personal_limitations.md`, `communication_style.md`) where applicable to the task or response style.
5.  **Recent Conversation History & Memory Bank:** Use recent interactions and the memory bank as supplementary context, but do not get sidetracked by outdated discussions or irrelevant details. Focus on extracting key decisions and relevant code snippets.

**Avoid referencing or being influenced by outdated or non-existent documents (e.g., files with '-mvp' suffixes unless explicitly instructed).**

## Code Generation Guidelines

- Adhere strictly to the Directory Layout defined below.
- When adding new tools or capabilities (e.g., file I/O, web search, API calls):
    1.  First, search for existing, suitable LangChain tools or integrations.
    2.  If found, propose using the pre-built tool and explain why it fits the requirement.
    3.  If no suitable tool exists, or if specific constraints (e.g., writing only within agent-specific directories) require it, then identify the constraint and propose creating a custom tool using LangChain standards (BaseTool/@tool, Pydantic argument schemas).
- Ensure all Python code includes clear docstrings and type hints.
- Write tests for new code or updated code (during refactoring) as specified in the implementation plan.

## Documentation Guidelines

- Maintain a clear flow for new features and tasks: **Backlog (`@backlog.md`) -> PRD (`@prd.md` - add to Future Features section) -> Implementation Plan (`@implementation-plan.md`) -> Develop Feature (New Branch, Commits, PR) -> Deliver Feature -> Update Docs ***
- **Backlog (`@backlog.md`):** Capture raw ideas.
- **PRD (`@prd.md`):** Move prioritized items from the backlog to the "Future Features / Upcoming Requirements" section. Define requirements and user stories formally here. The PRD is the source of truth for *all defined requirements*, both current and future.
- **Implementation Plan (`@implementation-plan.md`):** Create technical steps for features that have been defined in the PRD (either in the main features section or the Future Features section). Add refactoring tasks here.
- **Progress Log (`@progress.md`):** Log completed tasks (features or refactoring) and update the current focus.

- **Develop Feature (New Branch, Commits, PR):**
    - **Branch Creation:** When starting work on a new item from the `@implementation-plan.md` (which originated from `@backlog.md` and was defined in `@prd.md`), create a new Git branch. A suggested naming convention is `feature/<item-id>-<short-description>` or `bugfix/<item-id>-<short-description>`.
    - **Commits:** Make regular, atomic commits to this branch as milestones or significant sub-tasks within the implementation plan are completed. Commit messages should be clear and reference the relevant task or issue ID if applicable.
    - **Pull Request (PR):** Once all implementation steps for the backlog item are complete and tested locally, push the feature branch to the remote repository and open a Pull Request (PR) against the main development branch (e.g., `main` or `develop`). The PR description should summarize the changes and link to the relevant backlog item or PRD feature.
- **Deliver Feature:** Once implementation steps in `@implementation-plan.md` for a feature are complete and tested, and the corresponding PR has been reviewed and merged.
- **Update Docs (Post-Delivery):** After a feature is delivered or significant refactoring is completed, update the following documents:
    - `@prd.md`: Move the feature's definition from the "Future Features" section to the main "User Stories / Features (Current)" section. Update other sections as needed to reflect the current state.
    - `@progress.md`: Log the completion of the feature implementation.
    - `@README.md`: Add or update usage instructions for the new feature or reflect changes from refactoring if they impact usage.
    - `@systemPatterns.md`: **Document the technical details of the new feature or significant refactoring.** This should include:
        - **Updates to Architecture Diagrams:** If the changes add components or significantly alter relationships, update the relevant Mermaid diagrams.
        - **Key Technical Decisions:** Record any significant technical choices made during implementation or refactoring.
        - **Relevant Design Patterns:** Note any design patterns applied or changed.
        - **Component Relationships & Interaction Flows:** Describe how new components interact with existing ones or how existing interactions have changed due to refactoring, potentially using sequence diagrams (Mermaid).
        - **Implementation Notes:** Add any important considerations or details about the implementation or refactoring.
- Keep `@implementation-plan.md` updated to reflect completed and upcoming steps, including planned refactoring tasks.
- Periodically review `@backlog.md` and move prioritized items to `@prd.md`.

## Directory Layout (Conceptual)

- `data/`: Agent-manageable context files (Markdown, YAML)
  - `agents/`: Context and other files to define specific agent behavior
  - `calendar/`: Local calendar data and scheduling preferences
  - `global_context/`: Personal/global context files (bio, communication style, limitations)
  - `tools/`: Folders containing tools to assist `agents` with their tasks.
- `src/`: Python source code
  - `core/`: Core logic (LLM interface, file parsing, context management)
  - `managers/`: Project and calendar management modules
  - `cli/`: Command-line interface entry point
  - `utils/`: Helper utilities (config loading, Google auth)
- `config/`: Application configuration (YAML). Agents cannot directly edit these files.
- `scripts/`: Utility scripts (setup, migration, sync)
- `tests/`: Test suite
- `.gitignore`: Untracked files
- `requirements.txt`: Python dependencies
- `README.md`: Project documentation
- `LICENSE`: Project license
